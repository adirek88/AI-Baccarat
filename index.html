<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>AI Baccarat All-in-One</title>
  <meta name="viewport" content="width=480, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #e6f7ff 0%, #f9fcff 100%);
      margin: 0; min-height: 100vh;
    }
    .container {
      max-width: 440px;
      margin: 28px auto 28px auto;
      background: #fff;
      border-radius: 26px;
      box-shadow: 0 8px 32px #aee9ff29;
      padding: 20px 10px 22px 10px;
      border: 1.5px solid #e1f5ff;
    }
    .header {
      text-align: center;
      color: #1580c8;
      margin: 0 0 14px 0;
      font-size: 1.5em;
      font-weight: bold;
      letter-spacing: 1.5px;
      padding: 7px 0 2px 0;
      line-height: 1.3;
    }
    .input-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 18px;
      margin-top: 5px;
    }
    .input-row button {
      font-size: 1.17rem;
      font-weight: bold;
      border: none;
      border-radius: 17px;
      cursor: pointer;
      padding: 11px 31px;
      margin-bottom: 2px;
      box-shadow: 0 2px 10px #b8e6fb16;
      transition: all 0.13s;
      outline: none;
    }
    .input-row .B { background: #ffdde0; color: #d6002a; border: 2.5px solid #fca4b6; }
    .input-row .B:active { background: #ffb4c2;}
    .input-row .P { background: #d6eaff; color: #1470c6; border: 2.5px solid #81b8ec;}
    .input-row .P:active { background: #b1d2ff;}
    .input-row .del {background: #ffe7d5; color: #a75a00; border: 2.5px solid #ffd8b5;}
    .input-row .reset {background: #d5ffe6; color: #23a70b; border: 2.5px solid #bbf3ce;}
    .pattern-select {
      font-size: 1.09rem; padding:7px 15px;
      border-radius:11px;
      border:1.5px solid #b7e6ff;
      background: #f8fcff;
      margin-left: 7px;
    }
    section {
      margin-bottom: 21px;
      border-radius: 16px;
      background: #f3f9ff;
      box-shadow: 0 1.5px 10px #b8e6fb10;
      padding: 13px 8px 14px 8px;
    }
    .sec-title {
      font-size: 1.12em;
      color: #1477b6;
      font-weight: bold;
      margin-bottom: 6px;
      letter-spacing: 0.4px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-left: 5px solid #61d0ff;
      padding-left: 9px;
      background: #e6f3ff;
      border-radius: 8px 8px 8px 8px;
      margin-bottom: 15px;
    }
    .classic-scroll {
      max-height: 340px;
      overflow-y: auto;
      border-radius: 11px;
      background: #f8fcff;
      box-shadow: 0 0.5px 7px #b8e6fb09;
      margin-bottom: 0px;
    }
    table {
      border-collapse:collapse;
      width:100%;
      background: #fcfdff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0.5px 7px #b8e6fb08;
      margin: 0;
    }
    th, td {
      padding: 7px 8px;
      text-align: center;
      border: 1px solid #d1eaff;
      font-size: 1.05rem;
    }
    th {
      background: #daf1ff;
      color: #2c5183;
      font-weight: bold;
      letter-spacing: 0.2px;
    }
    .circle-b, .circle-p, .circle-null {
      display: inline-block; width: 32px; height: 32px;
      line-height: 32px; border-radius: 50%;
      font-weight: bold; font-size: 1.13em;
      box-shadow: 0 1.5px 7px #ddebf8b5; border: 2.5px solid transparent;
    }
    .circle-b { background: #ffdde0; color: #d6002a; border-color: #fca4b6; }
    .circle-p { background: #d6eaff; color: #1470c6; border-color: #81b8ec; }
    .circle-null { background: #f1f8ff; color: #bbb; border-color: #d7e9ff;}
    .latest { box-shadow: 0 0 0 4px #2fa5ff54, 0 2px 18px #69c0ff52 !important; border: 2.5px solid #1e90ff; }
    .row-next { background: #f6ffe6;}
    .cell-plus {color:#1eab48;font-weight:bold;}
    .cell-minus {color:#e93030;font-weight:bold;}
    .predict-now {background:#d2ffd9;color:#16934a;font-weight:bold;}
    .sugBox {margin:10px 0 4px 0;font-size:1.08em;text-align:center;font-weight:bold;}
    .good {color:#229900;}
    .bad {color:#d40000;}
    .mid {color:#cc8800;}
    .Bbet {background:#ffdde0;color:#d6002a;padding:2px 11px;border-radius:7px;}
    .Pbet {background:#d6eaff;color:#1470c6;padding:2px 11px;border-radius:7px;}
    .tag {font-weight:600; padding:2px 10px; border-radius:9px; font-size:0.96em;}
    .tag-good {background:#edffe2;color:#148d11;}
    .tag-bad {background:#fff5d7;color:#ce8a14;}
    .tag-hot {background:#ffe56d;color:#917a00;}
    .box-qual {
      margin-bottom:10px; border-radius:16px; padding:14px 10px;
      border:2px solid #aaf4d8; background:#f7fff7; text-align:center;
      font-size:1.11em;
    }
    .box-qual.good {background:#ebfff0; color:#14a149; border:2px solid #7ee6af;}
    .box-qual.bad {background:#fffbe6; color:#bb8900; border:2px solid #ffe399;}
    .box-qual .icon {font-size:1.36em;vertical-align:-4px;}
    @media (max-width: 560px){
      .container{max-width:99vw;}
      th,td{font-size:0.97rem;}
      .input-row button{padding: 10px 13px;font-size:1em;}
      .circle-b,.circle-p,.circle-null{width:27px;height:27px;line-height:27px;font-size:1em;}
      .classic-scroll{max-height:250px;}
      .sec-title{font-size:1.03em;}
    }
    #qualityMsg {margin-bottom: 8px;}
    #sugBestTop {margin-bottom:13px;}
  </style>
</head>
<body>
<div class="container">
  <div class="header">AI Baccarat<br>All-in-One <span style="font-size:0.7em; font-weight:500;">(Classic + ชุดน่าเล่น + AI แนะนำ)</span></div>
  <div class="input-row">
    <button class="B" onclick="addResult('B')">B</button>
    <button class="P" onclick="addResult('P')">P</button>
    <button class="del" onclick="removeLast()">ลบ</button>
    <button class="reset" onclick="resetAll()">รีเซ็ต</button>
  </div>
  <div id="qualityMsg"></div>
  <div id="sugBestTop" class="sugBox"></div>
  <section>
    <div class="sec-title">
      Classic Pattern
      <select id="patN" class="pattern-select" onchange="renderClassic()"></select>
      <span style="font-size:0.97em;color:#888;">เลือกขนาดชุด</span>
    </div>
    <div class="classic-scroll"><div id="classicBox"></div></div>
  </section>
  <section>
    <div class="sec-title">AI ตารางวิเคราะห์ชุดน่าเล่น (ตาม/สวน)</div>
    <div id="sugTable"></div>
  </section>
</div>
<script>
let results = [];
let userSelectedN = null;

window.onload = function(){
  let sel = document.getElementById('patN');
  for(let i=1; i<=11; i++) {
    let opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i + ' ตา';
    sel.appendChild(opt);
  }
  sel.addEventListener('change', function() {
    userSelectedN = sel.value;
    renderClassic();
  });
  renderAll();
};

function getPatternN() {
  let sel = document.getElementById('patN');
  let n = parseInt(sel.value);
  return (isNaN(n) || n<1) ? 1 : n;
}

function isPlayable() {
  if(results.length < 10) return false;
  let count = 0;
  for (let size = 1; size <= 11; size++) {
    let info = analyzeSet(size);
    if (!info) continue;
    if ((info.percent >= 60 && info.maxLose < 3) || (info.percentAnti >= 60 && info.maxLoseAnti < 3)) count++;
  }
  return count >= 3;
}
function isEvaluatable() {
  return results.length >= 10;
}
function evaluateQuality() {
  if (!isEvaluatable()) {
    return `<div class="box-qual bad"><span class="icon">✏️</span> กรุณากรอกผลอย่างน้อย 10 ตาก่อนประเมินคุณภาพขอน</div>`;
  }
  if (isPlayable()) {
    return `<div class="box-qual good"><span class="icon">✅</span> ขอนนี้น่าเล่น! <b>พบ Pattern ที่แม่นยำ</b><br>เลือกเล่นเฉพาะจังหวะที่ระบบแนะนำ</div>`;
  } else {
    return `<div class="box-qual bad"><span class="icon">⚠️</span> ขอนนี้ไม่น่าเล่น ยังไม่พบ Pattern ที่แม่นยำ<br>แนะนำให้ข้าม/เปลี่ยนห้อง หรือรอ Pattern ที่ชัดเจนก่อน</div>`;
  }
}

function renderClassic() {
  let N = getPatternN();
  let html = `<table>
    <tr>
      <th>No.</th>
      <th>ผลจริง</th>
      <th>ตัวแทง<br>(ย้อนหลัง ${N} ตา)</th>
      <th>+/–</th>
    </tr>`;
  let correct = 0, total = 0;
  for(let i=0; i<results.length; i++) {
    let pred = '-';
    if(i >= N) {
      let idx = (i-N) % N;
      if(idx < 0) idx += N;
      if (results[idx] !== undefined) pred = results[idx];
    }
    let mark = '';
    if(pred !== '-' && results[i]) {
      if(results[i] === pred) { mark = '<span class="cell-plus">+</span>'; correct++; }
      else { mark = '<span class="cell-minus">-</span>'; }
      total++;
    }
    let c = '';
    if(results[i] === 'B') c = 'circle-b';
    else if(results[i] === 'P') c = 'circle-p';
    else c = 'circle-null';
    let extra = (i === results.length-1) ? 'latest' : '';
    html += `<tr>
      <td>${i+1}</td>
      <td><span class="${c} ${extra}">${results[i]||''}</span></td>
      <td>${pred}</td>
      <td>${mark}</td>
    </tr>`;
  }
  let nextNo = results.length+1;
  let nextPred = '-';
  if(results.length >= N) {
    let idx = (results.length-N) % N;
    if(idx < 0) idx += N;
    if (results[idx] !== undefined) nextPred = results[idx];
  }
  if(nextPred !== '-') {
    html += `<tr class="row-next">
      <td>${nextNo}</td>
      <td><span class="circle-null">?</span></td>
      <td class="predict-now"><b>${nextPred}</b></td>
      <td></td>
    </tr>`;
  }
  html += `<tr><td colspan=2>% แม่น</td>
           <td colspan=2><b>${total?Math.round(100*correct/total):'-'}%</b></td></tr>`;
  html += `</table>`;
  document.getElementById('classicBox').innerHTML = html;
  setTimeout(()=>{
    let el = document.querySelector('.classic-scroll');
    if(el) el.scrollTop = el.scrollHeight;
  },50);
}

function analyzeSet(size) {
  if(results.length < size*2) return null;
  let correct=0, maxLose=0, loseNow=0;
  let correctAnti=0, maxLoseAnti=0, loseNowAnti=0;
  for(let i=size; i<results.length; i++) {
    let pred = '-';
    let idx = (i-size) % size;
    if(idx < 0) idx += size;
    if (results[idx] !== undefined) pred = results[idx];
    let anti = pred==='B'?'P':'B';
    if(results[i] === pred) { correct++; loseNow=0; } else { loseNow++; }
    if(loseNow > maxLose) maxLose = loseNow;
    if(results[i] === anti) { correctAnti++; loseNowAnti=0; } else { loseNowAnti++; }
    if(loseNowAnti > maxLoseAnti) maxLoseAnti = loseNowAnti;
  }
  let total = (results.length-size);
  let percent = total?Math.round(100*correct/total):0;
  let percentAnti = total?Math.round(100*correctAnti/total):0;
  return {
    size, percent, percentAnti, maxLose, maxLoseAnti, total,
    good: percent>=60 && maxLose<3,
    bad: percentAnti>=60 && maxLoseAnti<3,
    hot: (percent>=60 && maxLose<3)||(percentAnti>=60 && maxLoseAnti<3)
  };
}

function renderSuggestTable() {
  let suggestHTML = `<table>
  <tr>
    <th>ชุด</th>
    <th>% แม่น (ตาม)</th>
    <th>% แม่น (สวน)</th>
    <th>แพ้ติดสูงสุด (ตาม)</th>
    <th>แพ้ติดสูงสุด (สวน)</th>
    <th>สถานะ</th>
  </tr>`;
  for(let size=1; size<=11; size++) {
    let info = analyzeSet(size);
    if(!info) {
      suggestHTML += `<tr><td colspan="6" style="background:#f2faff;">กรอกผลเพิ่มเพื่อวิเคราะห์ชุด ${size} ตา</td></tr>`;
      continue;
    }
    let tag = "";
    if(info.good) tag = `<span class="tag tag-good">ชุดน่าตาม</span>`;
    if(info.bad) tag = `<span class="tag tag-bad">ชุดน่าสวน</span>`;
    if(info.hot) tag = `<span class="tag tag-hot">HOT!</span>`;
    suggestHTML += `<tr${info.hot?' style="background:#fffbe2"':''}>
      <td>${info.size}</td>
      <td class="${info.percent>=60?'cell-plus':'cell-minus'}">${info.percent}%</td>
      <td class="${info.percentAnti>=60?'cell-plus':'cell-minus'}">${info.percentAnti}%</td>
      <td>${info.maxLose}</td>
      <td>${info.maxLoseAnti}</td>
      <td>${tag}</td>
    </tr>`;
  }
  suggestHTML += `</table>`;
  document.getElementById('sugTable').innerHTML = suggestHTML;
}

function bestSuggest() {
  if (!isPlayable()) return "";
  let bestList = [];
  let maxPercent = 0;
  for (let size = 1; size <= 11; size++) {
    let info = analyzeSet(size);
    if (!info) continue;
    if (info.percent >= 60 && info.maxLose < 3) {
      if (info.percent > maxPercent) maxPercent = info.percent;
    }
    if (info.percentAnti >= 60 && info.maxLoseAnti < 3) {
      if (info.percentAnti > maxPercent) maxPercent = info.percentAnti;
    }
  }
  for (let size = 1; size <= 11; size++) {
    let info = analyzeSet(size);
    if (!info) continue;
    if (info.percent === maxPercent && info.percent >= 60 && info.maxLose < 3) {
      let side = '';
      if(results.length >= size)
      {
        let idx = (results.length - size) % size;
        if(idx < 0) idx += size;
        if (results[idx] !== undefined) side = results[idx];
      }
      bestList.push({ size, type: 'ตาม', side, percent: info.percent, lose: info.maxLose });
    }
    if (info.percentAnti === maxPercent && info.percentAnti >= 60 && info.maxLoseAnti < 3) {
      let side = '';
      if(results.length >= size)
      {
        let idx = (results.length - size) % size;
        if(idx < 0) idx += size;
        if (results[idx] !== undefined) side = (results[idx] === 'B' ? 'P' : 'B');
      }
      bestList.push({ size, type: 'สวน', side, percent: info.percentAnti, lose: info.maxLoseAnti });
    }
  }
  if (bestList.length > 1) {
    let conflictPairs = [];
    for (let i = 0; i < bestList.length; i++) {
      for (let j = i + 1; j < bestList.length; j++) {
        if (bestList[i].side !== bestList[j].side && bestList[i].side && bestList[j].side) {
          conflictPairs.push([bestList[i], bestList[j]]);
        }
      }
    }
    if (conflictPairs.length > 0) {
      let setTxt = conflictPairs.map(p => `ชุด ${p[0].size} (${p[0].side}) และ ชุด ${p[1].size} (${p[1].side})`).join(', ');
      return `<span class="mid">พบชุด % แม่นเท่ากันแต่ตัวแทงขัดกัน<br>
        <b>รอจังหวะเหมาะสม</b> (${setTxt})</span>`;
    } else {
      bestList.sort((a, b) => (a.lose - b.lose) || (a.size - b.size));
      let best = bestList[0];
      let betBtn = `<span class="${best.side == 'B' ? 'Bbet' : 'Pbet'}">${best.side}</span>`;
      let detail = (best.type == 'ตาม')
        ? `ถูก ${best.percent}% / แพ้ติดสูงสุด ${best.lose}`
        : `สวนถูก ${best.percent}% / แพ้ติดสูงสุด ${best.lose}`;
      let extra = (bestList.length > 1)
        ? `<br><span style="color:#bb8500;font-size:0.97em">(พบ % แม่นเท่ากันมากกว่า 1 ชุด แนะนำเลือกขนาดชุดที่แพ้ติดน้อยสุด)</span>` : '';
      autoSelectPatternN(best.size);
      return `
        <span class="good">แนะนำ: <b>ชุด${best.size}ตา</b> <u>${best.type == 'ตาม' ? 'ตามสูตร' : 'สวนสูตร'}</u> แทง${betBtn}</span><br>
        <span class="mid" style="font-size:0.98em">${detail}${extra}</span>
      `;
    }
  }
  if (bestList.length === 1) {
    let best = bestList[0];
    let betBtn = `<span class="${best.side == 'B' ? 'Bbet' : 'Pbet'}">${best.side}</span>`;
    let detail = (best.type == 'ตาม')
      ? `ถูก ${best.percent}% / แพ้ติดสูงสุด ${best.lose}`
      : `สวนถูก ${best.percent}% / แพ้ติดสูงสุด ${best.lose}`;
    autoSelectPatternN(best.size);
    return `
      <span class="good">แนะนำ: <b>ชุด${best.size}ตา</b> <u>${best.type == 'ตาม' ? 'ตามสูตร' : 'สวนสูตร'}</u> แทง${betBtn}</span><br>
      <span class="mid" style="font-size:0.98em">${detail}</span>
    `;
  }
  return "";
}

function renderBest() {
  document.getElementById('sugBestTop').innerHTML = bestSuggest();
}

function renderAll() {
  document.getElementById('qualityMsg').innerHTML = evaluateQuality();
  renderBest();
  renderClassic();
  renderSuggestTable();
}

function autoSelectPatternN(n) {
  let sel = document.getElementById('patN');
  if(!userSelectedN || userSelectedN != n.toString()) {
    if(sel.value != n) {
      sel.value = n;
      renderClassic();
    }
    userSelectedN = null;
  }
}

function addResult(val) { results.push(val); userSelectedN = null; renderAll(); }
function removeLast() { results.pop(); userSelectedN = null; renderAll(); }
function resetAll() { if(confirm('ล้างข้อมูล?')){results=[]; userSelectedN = null; renderAll();} }
</script>
</body>
</html>
